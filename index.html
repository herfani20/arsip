<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arsip Digital Abadi</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 650px; margin: 0 auto; padding: 20px; background: #f4f7f9; color: #333; }
        .box { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { color: #1a73e8; text-align: center; }
        .upload-area { background: #fafafa; border: 2px dashed #d1d9e0; padding: 20px; border-radius: 12px; margin-bottom: 30px; }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn-main { background: #1a73e8; color: white; border: none; font-weight: bold; cursor: pointer; }
        .file-item { 
            background: #fff; padding: 15px; border: 1px solid #eee; border-radius: 10px;
            display: flex; flex-direction: column; margin-top: 10px;
        }
        .file-controls { display: flex; gap: 10px; margin-top: 10px; }
        .dl-btn { background: #34a853; color: white; padding: 8px; text-decoration: none; border-radius: 6px; flex: 1; text-align: center; font-size: 13px; font-weight: bold; }
        .del-btn { background: #e74c3c; color: white; border: none; padding: 8px; border-radius: 6px; flex: 1; cursor: pointer; font-size: 13px; font-weight: bold; }
        #status { text-align: center; font-weight: bold; font-size: 13px; }
    </style>
</head>
<body>

<div class="box">
    <h2>üìÅ Arsip Digital Saya</h2>
    
    <div class="upload-area">
        <input type="file" id="pilih-file">
        <input type="text" id="nama-file" placeholder="Nama file simpanan...">
        <button class="btn-main" onclick="uploadKeCloud()">üöÄ SIMPAN KE ARSIP</button>
        <p id="status"></p>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h3>Daftar Arsip:</h3>
        <button onclick="muatDaftarFile()" style="width:auto; background:#6c757d; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">üîÑ Refresh</button>
    </div>
    
    <div id="daftar-file-container">
        <p style="text-align:center; color:#888;">Memuat gudang...</p>
    </div>
</div>

<script>
    const CLOUD_NAME = "doa3owxki"; 
    const UPLOAD_PRESET = "arsipsaya";

    // 1. FUNGSI UPLOAD
    async function uploadKeCloud() {
        const fileInput = document.getElementById('pilih-file');
        const namaInput = document.getElementById('nama-file');
        const status = document.getElementById('status');

        if (!fileInput.files[0] || !namaInput.value) {
            alert("Isi nama dan pilih file!");
            return;
        }

        status.innerText = "‚è≥ Menyimpan...";
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        formData.append('upload_preset', UPLOAD_PRESET);
        formData.append('public_id', namaInput.value); 
        formData.append('tags', 'arsip_pribadi'); 

        try {
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {
                method: 'POST',
                body: formData
            });

            if (res.ok) {
                status.innerText = "‚úÖ Berhasil Diarsipkan!";
                status.style.color = "green";
                namaInput.value = "";
                fileInput.value = "";
                setTimeout(muatDaftarFile, 2000);
            } else {
                status.innerText = "‚ùå Gagal. Cek setting Cloudinary.";
            }
        } catch (err) {
            status.innerText = "‚ùå Error Koneksi.";
        }
    }

    // 2. FUNGSI MUAT DAFTAR
    async function muatDaftarFile() {
        const container = document.getElementById('daftar-file-container');
        const url = `https://res.cloudinary.com/${CLOUD_NAME}/image/list/arsip_pribadi.json?cb=${new Date().getTime()}`;
        
        try {
            const res = await fetch(url);
            if (!res.ok) {
                container.innerHTML = "<p style='text-align:center;'>Gudang kosong.</p>";
                return;
            }
            
            const data = await res.json();
            container.innerHTML = ""; 

            data.resources.forEach(file => {
                const downloadUrl = `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/v${file.version}/${file.public_id}.${file.format}`;
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <span style="font-weight:bold;">${file.public_id}</span>
                    <div class="file-controls">
                        <a href="${downloadUrl}" class="dl-btn" target="_blank">DOWNLOAD</a>
                        <button class="del-btn" onclick="hapusFile('${file.public_id}')">HAPUS</button>
                    </div>
                `;
                container.appendChild(item);
            });
        } catch (err) {
            container.innerHTML = "<p style='text-align:center; color:red;'>Gagal memuat. Pastikan 'Resource List' di Security Cloudinary Unchecked.</p>";
        }
    }

    // 3. FUNGSI HAPUS (Catatan: Ini memerlukan pengaturan Admin API atau Manual)
    // Karena alasan keamanan, hapus file dari website statis terbatas.
    // Tombol ini akan mengarahkan Anda ke Media Library untuk menghapus secara aman.
    function hapusFile(publicId) {
        const konfirmasi = confirm(`Hapus file "${publicId}"? \n\nCatatan: Untuk keamanan arsip abadi, Anda akan diarahkan ke Media Library Cloudinary untuk menghapus secara permanen.`);
        if (konfirmasi) {
            window.open(`https://cloudinary.com/console/v2/media_library/search?q=${publicId}`, '_blank');
        }
    }

    window.onload = muatDaftarFile;
</script>

</body>
</html>
