<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arsip Digital Abadi</title>
    <style>
        /* CSS untuk tampilan yang bersih dan modern */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 650px; margin: 0 auto; padding: 20px; background: #f4f7f9; color: #333; }
        .box { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { color: #1a73e8; text-align: center; margin-bottom: 25px; }
        
        /* Area Input & Tombol */
        .upload-area { background: #fafafa; border: 2px dashed #d1d9e0; padding: 20px; border-radius: 12px; margin-bottom: 30px; }
        input[type="file"], input[type="text"] { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; font-size: 14px; }
        .btn-main { background: #1a73e8; color: white; border: none; padding: 14px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn-main:hover { background: #1557b0; }
        
        /* Area Daftar File */
        .list-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 20px; }
        .refresh-btn { background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        
        .file-item { 
            background: #fff; padding: 15px; border: 1px solid #eee; border-radius: 10px;
            display: flex; justify-content: space-between; align-items: center; margin-top: 10px;
            transition: transform 0.2s;
        }
        .file-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        .file-name { font-weight: 600; color: #2c3e50; font-size: 14px; }
        .dl-btn { background: #34a853; color: white; padding: 7px 15px; text-decoration: none; border-radius: 6px; font-size: 12px; font-weight: bold; }
        
        #status { text-align: center; font-weight: bold; font-size: 13px; margin-top: 10px; }
        .loader { color: #888; text-align: center; padding: 20px; font-style: italic; }
    </style>
</head>
<body>

<div class="box">
    <h2>üìÅ Arsip Digital Saya</h2>
    
    <div class="upload-area">
        <label style="font-size: 13px; font-weight: bold; color: #666;">Pilih Dokumen/Foto:</label>
        <input type="file" id="pilih-file">
        
        <label style="font-size: 13px; font-weight: bold; color: #666;">Nama Simpanan:</label>
        <input type="text" id="nama-file" placeholder="Contoh: Akta_Kelahiran_Asli">
        
        <button class="btn-main" onclick="uploadKeCloud()">üöÄ SIMPAN PERMANEN</button>
        <p id="status"></p>
    </div>

    <div class="list-header">
        <h3 style="margin: 0; font-size: 16px;">Daftar File Terarsip</h3>
        <button class="refresh-btn" onclick="muatDaftarFile()">üîÑ Refresh</button>
    </div>
    
    <div id="daftar-file-container">
        <div class="loader">Menghubungkan ke gudang awan...</div>
    </div>
</div>

<script>
    // DATA CLOUDINARY ANDA
    const CLOUD_NAME = "doa3owxki"; 
    const UPLOAD_PRESET = "arsipsaya";

    // FUNGSI UNGGAH
    async function uploadKeCloud() {
        const fileInput = document.getElementById('pilih-file');
        const namaInput = document.getElementById('nama-file');
        const status = document.getElementById('status');

        if (!fileInput.files[0] || !namaInput.value) {
            alert("Harap pilih file dan beri nama terlebih dahulu!");
            return;
        }

        status.innerText = "‚è≥ Sedang memproses... jangan tutup halaman.";
        status.style.color = "#f39c12";

        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        formData.append('upload_preset', UPLOAD_PRESET);
        formData.append('public_id', namaInput.value); 
        formData.append('tags', 'arsip_pribadi'); 

        try {
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {
                method: 'POST',
                body: formData
            });

            if (res.ok) {
                status.innerText = "‚úÖ BERHASIL! File telah diarsipkan.";
                status.style.color = "#27ae60";
                namaInput.value = "";
                fileInput.value = "";
                // Segarkan daftar setelah sukses
                setTimeout(muatDaftarFile, 2000);
            } else {
                status.innerText = "‚ùå GAGAL! Pastikan setting Security Cloudinary sudah benar.";
                status.style.color = "#e74c3c";
            }
        } catch (err) {
            status.innerText = "‚ùå Terjadi kesalahan jaringan.";
            status.style.color = "#e74c3c";
        }
    }

    // FUNGSI AMBIL DAFTAR FILE
    async function muatDaftarFile() {
        const container = document.getElementById('daftar-file-container');
        const cb = new Date().getTime(); // Mencegah cache browser
        
        try {
            const res = await fetch(`https://res.cloudinary.com/${CLOUD_NAME}/image/list/arsip_pribadi.json?cb=${cb}`);
            
            if (!res.ok) {
                container.innerHTML = "<p class='loader'>Belum ada file. Mulailah mengunggah!</p>";
                return;
            }
            
            const data = await res.json();
            container.innerHTML = ""; 

            if (data.resources.length === 0) {
                container.innerHTML = "<p class='loader'>Gudang kosong.</p>";
                return;
            }

            data.resources.forEach(file => {
                const downloadUrl = `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/v${file.version}/${file.public_id}.${file.format}`;
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <span class="file-name">${file.public_id}</span> 
                    <a href="${downloadUrl}" class="dl-btn" target="_blank">LIHAT/AMBIL</a>
                `;
                container.appendChild(item);
            });
        } catch (err) {
            container.innerHTML = "<div style='color:#e74c3c; font-size:12px; text-align:center; padding:20px;'>" +
                "‚ö†Ô∏è Gagal memuat daftar.<br>Pastikan di Cloudinary: <b>Settings > Security > Hapus Centang 'Resource List'</b></div>";
        }
    }

    // Jalankan saat pertama kali dibuka
    window.onload = muatDaftarFile;
</script>

</body>
</html>
